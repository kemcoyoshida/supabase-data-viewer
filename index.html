<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>データベース管理システム</title>
    <link rel="stylesheet" href="style.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Supabase JS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- ヘッダー -->
    <header class="top-header">
        <div class="header-content">
            <h1>データベース管理システム</h1>
            <div class="header-actions">
                <div class="notification-icon-wrapper">
                    <button class="header-icon-btn" id="notification-btn" title="通知">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="header-notification-badge">3</span>
                    </button>
                </div>
                <button class="header-btn">設定</button>
                <button class="header-btn">ログアウト</button>
            </div>
        </div>
    </header>

    <!-- メインコンテナ -->
    <div class="main-container">
        <!-- 左サイドバー（メニュー） -->
        <aside class="left-sidebar">
            <div class="sidebar-header">
                <h2>- メインメニュー -</h2>
            </div>
            <nav class="main-menu">
                <button class="menu-item active" data-page="dashboard">ダッシュボード</button>
                <button class="menu-item" data-page="list">一覧表示</button>
                <button class="menu-item" data-page="register">登録</button>
                <button class="menu-item" data-page="search">検索</button>
                <button class="menu-item" data-page="aggregate">集計</button>
            </nav>
            <div class="table-list-section">
                <h3>テーブル一覧</h3>
                <input type="text" id="table-search-input" class="table-search-input" placeholder="テーブルを検索...">
                <div id="table-list-content" class="table-list-content">
                    <p class="loading">読み込み中...</p>
                </div>
            </div>
            <div class="sidebar-footer">
                <p>ログインユーザー: システム管理者</p>
                <p id="current-time"></p>
            </div>
        </aside>

        <!-- メインコンテンツエリア -->
        <main class="content-area">
            <!-- ダッシュボードページ -->
            <div id="dashboard-page" class="page active">
                <div class="dashboard-header">
                    <div>
                        <h2>ダッシュボード</h2>
                        <p class="dashboard-subtitle">主要指標とアクティビティを確認</p>
                    </div>
                    <div class="dashboard-search">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="検索..." />
                    </div>
                </div>

                <!-- KPIカード -->
                <div class="dashboard-grid">
                    <div class="dashboard-card kpi-card">
                        <div class="dashboard-card-header">
                            <div class="kpi-icon-wrapper">
                                <i class="fas fa-boxes"></i>
                            </div>
                            <h3>生産量</h3>
                        </div>
                        <div class="dashboard-card-value" id="kpi-production">-</div>
                    </div>
                    <div class="dashboard-card kpi-card">
                        <div class="dashboard-card-header">
                            <div class="kpi-icon-wrapper">
                                <i class="fas fa-cog"></i>
                            </div>
                            <h3>稼働率</h3>
                        </div>
                        <div class="dashboard-card-value" id="kpi-operating-rate">-</div>
                    </div>
                    <div class="dashboard-card kpi-card">
                        <div class="dashboard-card-header">
                            <div class="kpi-icon-wrapper">
                                <i class="fas fa-warehouse"></i>
                            </div>
                            <h3>在庫数</h3>
                        </div>
                        <div class="dashboard-card-value" id="kpi-inventory">-</div>
                    </div>
                    <div class="dashboard-card kpi-card">
                        <div class="dashboard-card-header">
                            <div class="kpi-icon-wrapper">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <h3>納期遵守率</h3>
                        </div>
                        <div class="dashboard-card-value" id="kpi-delivery-rate">-</div>
                    </div>
                </div>

                <!-- 上段：アクティビティグラフ、カレンダー、イベント -->
                <div class="dashboard-top-row">
                    <div class="dashboard-card activity-card">
                        <div class="card-header-with-tabs">
                            <h3>アクティビティ</h3>
                            <div class="tabs">
                                <button class="tab-btn active" data-tab="daily">Daily</button>
                                <button class="tab-btn" data-tab="weekly">Weekly</button>
                            </div>
                        </div>
                        <canvas id="activity-bar-chart"></canvas>
                    </div>
                    <div class="dashboard-card calendar-card">
                        <div class="card-header-with-action">
                            <h3 id="calendar-month-year">2024/01 January</h3>
                            <button class="icon-btn"><i class="fas fa-plus"></i></button>
                        </div>
                        <div id="calendar-grid" class="calendar-grid"></div>
                    </div>
                    <div class="dashboard-card events-card">
                        <h3>イベント</h3>
                        <div id="events-list" class="events-list"></div>
                    </div>
                </div>

                <!-- 中段：折れ線グラフと進捗インジケーター -->
                <div class="dashboard-middle-row">
                    <div class="dashboard-card chart-card">
                        <div class="card-header-with-tabs">
                            <h3>アクティビティ</h3>
                            <div class="tabs">
                                <button class="tab-btn" data-tab="monthly">Monthly</button>
                                <button class="tab-btn active" data-tab="weekly">Weekly</button>
                            </div>
                        </div>
                        <canvas id="activity-line-chart"></canvas>
                    </div>
                    <div class="dashboard-card progress-card">
                        <h3>進捗状況</h3>
                        <div id="progress-indicators" class="progress-indicators"></div>
                    </div>
                </div>

                <!-- 下段：グラフ・チャート -->
                <div class="charts-grid">
                    <div class="dashboard-card chart-card">
                        <h3><i class="fas fa-chart-line"></i> 月別生産量</h3>
                        <canvas id="production-chart"></canvas>
                    </div>
                    <div class="dashboard-card chart-card">
                        <h3><i class="fas fa-chart-pie"></i> 工場別稼働率</h3>
                        <canvas id="operating-rate-chart"></canvas>
                    </div>
                    <div class="dashboard-card chart-card">
                        <h3><i class="fas fa-chart-bar"></i> 不良率</h3>
                        <canvas id="defect-rate-chart"></canvas>
                    </div>
                </div>

                <!-- Todoリスト -->
                <div class="dashboard-card todo-dashboard-card">
                    <div class="section-header">
                        <h3><i class="fas fa-tasks"></i> Todoリスト</h3>
                        <button class="btn-primary btn-small" id="add-todo-dashboard-btn">
                            <i class="fas fa-plus"></i> 追加
                        </button>
                    </div>
                    <div class="todo-dashboard-filter">
                        <button class="filter-btn-small active" data-filter="all">すべて</button>
                        <button class="filter-btn-small" data-filter="pending">未完了</button>
                        <button class="filter-btn-small" data-filter="completed">完了</button>
                    </div>
                    <div id="todo-dashboard-list" class="todo-dashboard-list">
                        <!-- 動的に生成されます -->
                    </div>
                </div>
            </div>

            <!-- 一覧表示ページ -->
            <div id="list-page" class="page">
                <div class="page-title">
                    <h2 id="current-table-title">機械コード管理 - 一覧表示</h2>
                </div>

                <!-- 検索・フィルターセクション -->
                <div class="search-section">
                    <div class="search-field-full">
                        <label>🔍 検索</label>
                        <div class="search-row">
                            <select id="filter-column-select" class="column-filter-select">
                                <option value="">すべての項目を検索</option>
                            </select>
                            <input type="text" id="filter-global-search" class="search-input" placeholder="キーワードを入力して検索">
                        </div>
                    </div>
                    <div class="search-actions">
                        <button id="execute-search" class="btn-primary">検索実行</button>
                        <button id="clear-search" class="btn-secondary">クリア</button>
                    </div>
                </div>

                <!-- データ操作ボタン -->
                <div class="data-actions">
                    <div class="data-actions-left">
                        <button id="new-register" class="btn-primary">新規登録</button>
                        <button id="csv-export" class="btn-secondary">CSV出力</button>
                        <button id="csv-import" class="btn-secondary">CSVインポート</button>
                        <input type="file" id="csv-file-input" accept=".csv" style="display: none;">
                    </div>
                    <div class="selection-controls">
                        <span id="selection-count" class="selection-count">選択数: 0</span>
                        <div class="selection-buttons">
                            <button id="select-all-btn" class="btn-selection">全選択</button>
                            <button id="deselect-all-btn" class="btn-selection">全解除</button>
                        </div>
                    </div>
                </div>

                <!-- ページネーション情報 -->
                <div class="pagination-info">
                    <span id="page-info">1/1ページ (1-20/該当レコード数: 0 / 全レコード数: 0)</span>
                    <div class="pagination-controls">
                        <button id="first-page" class="page-btn">|<</button>
                        <button id="prev-page" class="page-btn"><</button>
                        <button id="next-page" class="page-btn">></button>
                        <button id="last-page" class="page-btn">>|</button>
                    </div>
                </div>

                <!-- データテーブル -->
                <div class="table-container">
                    <table id="data-table" class="data-table">
                        <thead id="table-head"></thead>
                        <tbody id="table-body"></tbody>
                    </table>
                </div>
            </div>

            <!-- 登録ページ -->
            <div id="register-page" class="page">
                <div class="page-title">
                    <h2>登録・編集</h2>
                </div>
                <div class="register-buttons">
                    <button class="register-btn" data-type="work-ticket">作業票の登録</button>
                    <button class="register-btn" data-type="barcode">バーコードリーダー版 作業票の登録</button>
                    <button class="register-btn" data-type="misc-purchase">諸掛購入登録</button>
                    <button class="register-btn" data-type="misc-delivery">諸掛納入処理</button>
                    <button class="register-btn" data-type="delivery-approval">納期承認</button>
                    <button class="register-btn" data-type="shipping">出荷管理</button>
                    <button class="register-btn" data-type="outsource-delivery">外注・材料 納入処理</button>
                    <button class="register-btn" data-type="parts-delivery">購入部品 納入処理</button>
                    <button class="register-btn" data-type="surplus-register">余り品登録</button>
                    <button class="register-btn" data-type="surplus-search">余り品検索</button>
                    <button class="register-btn" data-type="project-shipping">工事番号出荷登録</button>
                    <button class="register-btn" data-type="budget">部品単位予算登録</button>
                </div>
            </div>

            <!-- 検索ページ -->
            <div id="search-page" class="page">
                <div class="page-title">
                    <h2>検索</h2>
                </div>
                <div class="search-buttons">
                    <button class="search-btn">購入部品・材料・諸経費検索</button>
                    <button class="search-btn">外注加工検索</button>
                    <button class="search-btn">業者別発注済み外注加工</button>
                    <button class="search-btn">納入予定カレンダー</button>
                    <button class="search-btn">加工進捗検索</button>
                    <button class="search-btn">機械で検索 加工進捗</button>
                    <button class="search-btn">名称による原価検索</button>
                    <button class="search-btn">出図・手配状況</button>
                    <button class="search-btn">加工振り分け状況</button>
                    <button class="search-btn">売上年月で検索 工事一覧</button>
                </div>
            </div>

            <!-- 集計ページ -->
            <div id="aggregate-page" class="page">
                <div class="page-title">
                    <h2>集計</h2>
                </div>
                <div class="aggregate-buttons">
                    <button class="aggregate-btn">工事番号による原価集計</button>
                    <button class="aggregate-btn">図面番号による原価集計</button>
                    <button class="aggregate-btn">機械から工事番号検索</button>
                    <button class="aggregate-btn">工事番号で検索する 部品ごとの原価集計</button>
                    <button class="aggregate-btn">業者別該当月 納期と納入件数</button>
                </div>
            </div>
        </main>

    </div>

    <!-- メッセージ表示エリア -->
    <div id="message-area"></div>

    <!-- 登録・編集モーダル（中央表示） -->
    <div id="register-modal" class="modal-overlay" style="display: none;">
        <div class="modal-container register-modal-container">
            <div class="modal-header register-modal-header">
                <h3 id="modal-title">新規登録</h3>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body register-modal-body">
                <form id="register-form" class="register-form" novalidate>
                    <div id="register-form-fields" class="form-fields"></div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" id="cancel-register">キャンセル</button>
                        <button type="submit" class="btn-primary">登録</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 削除確認モーダル -->
    <div id="delete-confirm-modal" class="modal-overlay" style="display: none;">
        <div class="modal-container delete-modal">
            <div class="modal-header delete-header">
                <h3>⚠️ データ削除の確認</h3>
            </div>
            <div class="modal-body delete-body">
                <p class="delete-message">このデータを削除しますか？</p>
                <p class="delete-warning">この操作は取り消せません。</p>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" id="cancel-delete">キャンセル</button>
                    <button type="button" class="btn-danger" id="confirm-delete">削除する</button>
                </div>
            </div>
        </div>
    </div>

    <!-- メッセージ表示エリア -->
    <div id="message-area"></div>

    <!-- 通知ドロップダウン -->
    <div id="notification-dropdown" class="notification-dropdown" style="display: none;">
        <div class="notification-dropdown-header">
            <h4>通知</h4>
            <button class="notification-close" id="notification-close-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="notification-dropdown-body" id="notification-dropdown-body">
            <!-- 動的に生成されます -->
        </div>
        <div class="notification-dropdown-footer">
            <a href="#" class="notification-view-all">すべて表示</a>
        </div>
    </div>

    <!-- スクリプト -->
    <script src="config.js"></script>
    <script src="app.js"></script>
    <script src="todo.js"></script>
</body>
</html>
